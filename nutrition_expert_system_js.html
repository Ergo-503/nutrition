<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ï–∫—Å–ø–µ—Ä—Ç–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Ä–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è –¥–ª—è —Å–ø–æ—Ä—Ç—Å–º–µ–Ω—ñ–≤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .input-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
        }

        .section-title {
            font-size: 1.5rem;
            color: #495057;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .form-group {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .form-group h3 {
            color: #6c757d;
            margin-bottom: 15px;
            font-size: 1.1rem;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 8px;
        }

        .input-field {
            margin-bottom: 15px;
        }

        .input-field label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
        }

        .input-field input,
        .input-field select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .input-field input:focus,
        .input-field select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
            transform: scale(1.2);
        }

        .calculate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            display: block;
            margin: 30px auto;
            transition: transform 0.3s, box-shadow 0.3s;
            font-weight: bold;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .calculate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results-section {
            display: none;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .result-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
        }

        .result-card h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .needs-display {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .need-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e9ecef;
        }

        .need-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #667eea;
            display: block;
        }

        .need-label {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 5px;
        }

        .products-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            background: #f8f9fa;
        }

        .product-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #28a745;
        }

        .product-name {
            font-weight: 500;
            color: #495057;
        }

        .product-details {
            font-size: 0.9rem;
            color: #6c757d;
        }

        .explanation-card {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 12px;
            padding: 20px;
            margin-top: 25px;
        }

        .explanation-card h3 {
            color: #0066cc;
            margin-bottom: 15px;
        }

        .explanation-text {
            line-height: 1.6;
            color: #495057;
        }

        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .chart-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .chart-title {
            text-align: center;
            margin-bottom: 15px;
            color: #495057;
            font-weight: bold;
        }

        .pie-chart {
            width: 250px;
            height: 250px;
            margin: 0 auto;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
            font-size: 1.1rem;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #f5c6cb;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #c3e6cb;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .needs-display {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèÉ‚Äç‚ôÇÔ∏è –ï–∫—Å–ø–µ—Ä—Ç–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è</h1>
            <p>–ü–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è —Å–ø–æ—Ä—Ç—Å–º–µ–Ω—ñ–≤</p>
        </div>

        <div class="main-content">
            <div class="input-section">
                <h2 class="section-title">–í–≤–µ–¥—ñ—Ç—å –≤–∞—à—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏</h2>
                
                <div class="form-grid">
                    <div class="form-group">
                        <h3>üë§ –û—Å–æ–±–∏—Å—Ç—ñ –¥–∞–Ω—ñ</h3>
                        
                        <div class="input-field">
                            <label for="gender">–°—Ç–∞—Ç—å:</label>
                            <select id="gender">
                                <option value="male">–ß–æ–ª–æ–≤—ñ—á–∞</option>
                                <option value="female">–ñ—ñ–Ω–æ—á–∞</option>
                            </select>
                        </div>

                        <div class="input-field">
                            <label for="age">–í—ñ–∫ (—Ä–æ–∫—ñ–≤):</label>
                            <input type="number" id="age" min="16" max="80" value="25">
                        </div>

                        <div class="input-field">
                            <label for="weight">–í–∞–≥–∞ (–∫–≥):</label>
                            <input type="number" id="weight" min="40" max="200" step="0.1" value="70">
                        </div>

                        <div class="input-field">
                            <label for="height">–ó—Ä—ñ—Å—Ç (—Å–º):</label>
                            <input type="number" id="height" min="140" max="220" value="175">
                        </div>
                    </div>

                    <div class="form-group">
                        <h3>üèãÔ∏è –°–ø–æ—Ä—Ç–∏–≤–Ω–∞ –¥—ñ—è–ª—å–Ω—ñ—Å—Ç—å</h3>
                        
                        <div class="input-field">
                            <label for="activity">–†—ñ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ:</label>
                            <select id="activity">
                                <option value="1.2">–î—É–∂–µ –Ω–∏–∑—å–∫–∞ (—Å–∏–¥—è—á–∏–π —Å–ø–æ—Å—ñ–± –∂–∏—Ç—Ç—è)</option>
                                <option value="1.375">–ù–∏–∑—å–∫–∞ (1-3 —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è/—Ç–∏–∂–¥–µ–Ω—å)</option>
                                <option value="1.55" selected>–°–µ—Ä–µ–¥–Ω—è (3-5 —Ç—Ä–µ–Ω—É–≤–∞–Ω—å/—Ç–∏–∂–¥–µ–Ω—å)</option>
                                <option value="1.725">–í–∏—Å–æ–∫–∞ (6-7 —Ç—Ä–µ–Ω—É–≤–∞–Ω—å/—Ç–∏–∂–¥–µ–Ω—å)</option>
                                <option value="1.9">–î—É–∂–µ –≤–∏—Å–æ–∫–∞ (—â–æ–¥–µ–Ω–Ω—ñ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è)</option>
                            </select>
                        </div>

                        <div class="input-field">
                            <label for="goal">–ú–µ—Ç–∞:</label>
                            <select id="goal">
                                <option value="maintain" selected>–ü—ñ–¥—Ç—Ä–∏–º–∞–Ω–Ω—è —Ñ–æ—Ä–º–∏</option>
                                <option value="gain">–ù–∞–±—ñ—Ä –º–∞—Å–∏</option>
                                <option value="lose">–°—Ö—É–¥–Ω–µ–Ω–Ω—è/–°—É—à–∫–∞</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <h3>ü•ó –î—ñ—î—Ç–∏—á–Ω—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è</h3>
                        
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="vegan">
                                <label for="vegan">–í–µ–≥–∞–Ω—Å—å–∫–∞ –¥—ñ—î—Ç–∞</label>
                            </div>
                            
                            <div class="checkbox-item">
                                <input type="checkbox" id="diabetes">
                                <label for="diabetes">–î—ñ–∞–±–µ—Ç (–Ω–∏–∑—å–∫–∏–π –ì–Ü)</label>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="calculate-btn" onclick="calculateNutrition()">
                    üîç –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ —Ä–∞—Ü—ñ–æ–Ω
                </button>
            </div>

            <div id="results" class="results-section">
                <h2 class="section-title">–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É</h2>
                
                <div class="results-grid">
                    <div class="result-card">
                        <h3>üìä –í–∞—à—ñ –ø–æ—Ç—Ä–µ–±–∏</h3>
                        <div id="nutritional-needs" class="needs-display"></div>
                    </div>

                    <div class="result-card">
                        <h3>üõí –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ñ –ø—Ä–æ–¥—É–∫—Ç–∏</h3>
                        <div id="products-list" class="products-list"></div>
                        <div id="total-cost" style="margin-top: 15px; font-weight: bold; color: #28a745;"></div>
                    </div>
                </div>

                <div class="explanation-card">
                    <h3>üí° –ü–æ—è—Å–Ω–µ–Ω–Ω—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π</h3>
                    <div id="explanation" class="explanation-text"></div>
                </div>

                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-title">–†–æ–∑–ø–æ–¥—ñ–ª –º–∞–∫—Ä–æ–Ω—É—Ç—Ä—ñ—î–Ω—Ç—ñ–≤</div>
                        <canvas id="macroChart" class="pie-chart"></canvas>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-title">–ü—Ä–æ–≥–Ω–æ–∑ –∑–º—ñ–Ω–∏ –≤–∞–≥–∏</div>
                        <canvas id="weightChart" width="300" height="200"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ë–∞–∑–∞ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è
        const PRODUCTS_DATABASE = [
            {name: "–ö—É—Ä—è—á–∞ –≥—Ä—É–¥–∫–∞", protein: 23.0, fat: 1.2, carbs: 0.0, calories: 113, cost: 0.8, vegan: false, gi: 0},
            {name: "–†–∏—Å –∫—Ä—É–≥–ª–æ–∑–µ—Ä–Ω–∏—Å—Ç–∏–π", protein: 2.7, fat: 0.3, carbs: 77.0, calories: 344, cost: 0.25, vegan: true, gi: 64},
            {name: "–í—ñ–≤—Å—è–Ω–∫–∞", protein: 12.0, fat: 6.2, carbs: 61.0, calories: 342, cost: 0.3, vegan: true, gi: 42},
            {name: "–ë–∞–Ω–∞–Ω–∏", protein: 1.1, fat: 0.2, carbs: 21.0, calories: 89, cost: 0.6, vegan: true, gi: 62},
            {name: "–ú–æ–ª–æ–∫–æ 2.5%", protein: 2.8, fat: 2.5, carbs: 4.7, calories: 52, cost: 0.6, vegan: false, gi: 27},
            {name: "–Ø–π—Ü—è –∫—É—Ä—è—á—ñ", protein: 12.7, fat: 11.5, carbs: 0.7, calories: 157, cost: 0.6, vegan: false, gi: 0},
            {name: "–û–ª—ñ—è —Å–æ–Ω—è—à–Ω–∏–∫–æ–≤–∞", protein: 0.0, fat: 99.9, carbs: 0.0, calories: 899, cost: 0.5, vegan: true, gi: 0},
            {name: "–ì—Ä–µ—á–∫–∞", protein: 12.6, fat: 2.6, carbs: 68.0, calories: 343, cost: 0.45, vegan: true, gi: 54},
            {name: "–¢–≤–æ—Ä–æ–≥ 5%", protein: 17.2, fat: 5.0, carbs: 1.8, calories: 121, cost: 0.9, vegan: false, gi: 27},
            {name: "–ö–∞—Ä—Ç–æ–ø–ª—è", protein: 2.0, fat: 0.1, carbs: 16.0, calories: 77, cost: 0.2, vegan: true, gi: 85},
            {name: "–†–∏–±–∞ –º–æ—Ä—Å—å–∫–∞", protein: 20.0, fat: 8.0, carbs: 0.0, calories: 150, cost: 3.0, vegan: false, gi: 0},
            {name: "–ö–≤–∞—Å–æ–ª—è —á–µ—Ä–≤–æ–Ω–∞", protein: 8.4, fat: 0.3, carbs: 13.7, calories: 93, cost: 0.6, vegan: true, gi: 29},
            {name: "–ß–µ—á–µ–≤–∏—Ü—è", protein: 9.0, fat: 0.4, carbs: 20.0, calories: 116, cost: 0.8, vegan: true, gi: 29},
            {name: "–ì–æ—Ä—ñ—Ö–∏ –≤–æ–ª–æ—Å—å–∫—ñ", protein: 16.2, fat: 60.8, carbs: 11.1, calories: 656, cost: 4.0, vegan: true, gi: 15},
            {name: "–•–ª—ñ–± –∂–∏—Ç–Ω—ñ–π", protein: 6.6, fat: 1.2, carbs: 34.2, calories: 174, cost: 0.6, vegan: true, gi: 58}
        ];

        // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ BMR –∑–∞ —Ñ–æ—Ä–º—É–ª–æ—é –ú—ñ—Ñ—Ñ–ª—ñ–Ω–∞-–°–∞–Ω-–î–∂–µ–æ—Ä
        function calculateBMR(weight, height, age, gender) {
            if (gender === 'male') {
                return 10 * weight + 6.25 * height - 5 * age + 5;
            } else {
                return 10 * weight + 6.25 * height - 5 * age - 161;
            }
        }

        // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –ø–æ—Ç—Ä–µ–± —É –º–∞–∫—Ä–æ–Ω—É—Ç—Ä—ñ—î–Ω—Ç–∞—Ö
        function calculateMacronutrients(calories, weight, goal) {
            let proteinRatio, fatRatio;
            
            switch(goal) {
                case 'gain':
                    proteinRatio = 2.2; // –≥ –Ω–∞ –∫–≥ –≤–∞–≥–∏
                    fatRatio = 0.20; // 20% –≤—ñ–¥ –∫–∞–ª–æ—Ä—ñ–π
                    break;
                case 'lose':
                    proteinRatio = 2.5;
                    fatRatio = 0.30; // 30% –≤—ñ–¥ –∫–∞–ª–æ—Ä—ñ–π
                    break;
                default: // maintain
                    proteinRatio = 1.8;
                    fatRatio = 0.25; // 25% –≤—ñ–¥ –∫–∞–ª–æ—Ä—ñ–π
            }
            
            const protein = weight * proteinRatio;
            const fat = (calories * fatRatio) / 9; // 9 –∫–∫–∞–ª –Ω–∞ –≥—Ä–∞–º –∂–∏—Ä—É
            const carbsCalories = calories - (protein * 4) - (fat * 9);
            const carbs = carbsCalories / 4; // 4 –∫–∫–∞–ª –Ω–∞ –≥—Ä–∞–º –≤—É–≥–ª–µ–≤–æ–¥—ñ–≤
            
            return {
                protein: Math.round(protein),
                fat: Math.round(fat),
                carbs: Math.round(carbs)
            };
        }

        // –ü—Ä–æ—Å—Ç–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó (–∂–∞–¥—ñ–±–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥)
        function optimizeProducts(targetCalories, targetProtein, targetFat, targetCarbs, isVegan, isDiabetic) {
            let availableProducts = PRODUCTS_DATABASE.filter(product => {
                if (isVegan && !product.vegan) return false;
                if (isDiabetic && product.gi > 55 && product.gi !== 0) return false;
                return true;
            });

            if (availableProducts.length === 0) {
                throw new Error('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ –¥–ª—è –≤–∏–±—Ä–∞–Ω–∏—Ö –æ–±–º–µ–∂–µ–Ω—å');
            }

            let selectedProducts = [];
            let currentCalories = 0;
            let currentProtein = 0;
            let currentFat = 0;
            let currentCarbs = 0;
            let totalCost = 0;
            
            // –°–æ—Ä—Ç—É—î–º–æ –ø—Ä–æ–¥—É–∫—Ç–∏ –∑–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—é (–∫–∞–ª–æ—Ä—ñ—ó/—Ü—ñ–Ω–∞)
            availableProducts.sort((a, b) => (b.calories / b.cost) - (a.calories / a.cost));
            
            // –°–ø–æ—á–∞—Ç–∫—É –¥–æ–¥–∞—î–º–æ –æ—Å–Ω–æ–≤–Ω—ñ –¥–∂–µ—Ä–µ–ª–∞ –±—ñ–ª–∫–∞
            const proteinSources = availableProducts.filter(p => p.protein > 15);
            if (proteinSources.length > 0) {
                for (let product of proteinSources.slice(0, 2)) {
                    const amount = Math.min(200, (targetProtein * 0.4) / product.protein * 100);
                    if (amount > 20) {
                        selectedProducts.push({
                            ...product,
                            amount: Math.round(amount)
                        });
                        
                        currentCalories += (product.calories * amount) / 100;
                        currentProtein += (product.protein * amount) / 100;
                        currentFat += (product.fat * amount) / 100;
                        currentCarbs += (product.carbs * amount) / 100;
                        totalCost += (product.cost * amount) / 100;
                    }
                }
            }
            
            // –î–æ–¥–∞—î–º–æ –≤—É–≥–ª–µ–≤–æ–¥–Ω—ñ –ø—Ä–æ–¥—É–∫—Ç–∏
            const carbSources = availableProducts.filter(p => p.carbs > 50 && !selectedProducts.some(s => s.name === p.name));
            for (let product of carbSources.slice(0, 2)) {
                const neededCarbs = Math.max(0, targetCarbs - currentCarbs);
                const amount = Math.min(150, (neededCarbs * 0.6) / product.carbs * 100);
                if (amount > 20) {
                    selectedProducts.push({
                        ...product,
                        amount: Math.round(amount)
                    });
                    
                    currentCalories += (product.calories * amount) / 100;
                    currentProtein += (product.protein * amount) / 100;
                    currentFat += (product.fat * amount) / 100;
                    currentCarbs += (product.carbs * amount) / 100;
                    totalCost += (product.cost * amount) / 100;
                }
            }
            
            // –î–æ–¥–∞—î–º–æ –∂–∏—Ä–∏
            const fatSources = availableProducts.filter(p => p.fat > 20 && !selectedProducts.some(s => s.name === p.name));
            if (fatSources.length > 0 && currentFat < targetFat * 0.8) {
                const product = fatSources[0];
                const neededFat = targetFat - currentFat;
                const amount = Math.min(50, (neededFat * 0.8) / product.fat * 100);
                if (amount > 5) {
                    selectedProducts.push({
                        ...product,
                        amount: Math.round(amount)
                    });
                    
                    currentCalories += (product.calories * amount) / 100;
                    currentProtein += (product.protein * amount) / 100;
                    currentFat += (product.fat * amount) / 100;
                    currentCarbs += (product.carbs * amount) / 100;
                    totalCost += (product.cost * amount) / 100;
                }
            }
            
            // –î–æ–¥–∞—î–º–æ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –ø—Ä–æ–¥—É–∫—Ç–∏ –¥–ª—è –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è —Ü—ñ–ª—å–æ–≤–æ—ó –∫–∞–ª–æ—Ä—ñ–π–Ω–æ—Å—Ç—ñ
            while (currentCalories < targetCalories * 0.95 && selectedProducts.length < 8) {
                const remainingProducts = availableProducts.filter(p => 
                    !selectedProducts.some(s => s.name === p.name) && p.calories > 50
                );
                
                if (remainingProducts.length === 0) break;
                
                const product = remainingProducts[0];
                const neededCalories = targetCalories - currentCalories;
                const amount = Math.min(100, (neededCalories * 0.3) / product.calories * 100);
                
                if (amount > 10) {
                    selectedProducts.push({
                        ...product,
                        amount: Math.round(amount)
                    });
                    
                    currentCalories += (product.calories * amount) / 100;
                    currentProtein += (product.protein * amount) / 100;
                    currentFat += (product.fat * amount) / 100;
                    currentCarbs += (product.carbs * amount) / 100;
                    totalCost += (product.cost * amount) / 100;
                } else {
                    break;
                }
            }
            
            return {
                products: selectedProducts,
                totalCost: Math.round(totalCost * 100) / 100,
                actualNutrition: {
                    calories: Math.round(currentCalories),
                    protein: Math.round(currentProtein),
                    fat: Math.round(currentFat),
                    carbs: Math.round(currentCarbs)
                }
            };
        }

        // –ì–æ–ª–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É
        function calculateNutrition() {
            try {
                // –û—Ç—Ä–∏–º—É—î–º–æ –¥–∞–Ω—ñ –∑ —Ñ–æ—Ä–º–∏
                const gender = document.getElementById('gender').value;
                const age = parseInt(document.getElementById('age').value);
                const weight = parseFloat(document.getElementById('weight').value);
                const height = parseInt(document.getElementById('height').value);
                const activityLevel = parseFloat(document.getElementById('activity').value);
                const goal = document.getElementById('goal').value;
                const isVegan = document.getElementById('vegan').checked;
                const isDiabetic = document.getElementById('diabetes').checked;

                // –í–∞–ª—ñ–¥–∞—Ü—ñ—è
                if (!age || !weight || !height || age < 16 || age > 80 || weight < 40 || weight > 200 || height < 140 || height > 220) {
                    throw new Error('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—ñ –¥–∞–Ω—ñ (–≤—ñ–∫: 16-80, –≤–∞–≥–∞: 40-200 –∫–≥, –∑—Ä—ñ—Å—Ç: 140-220 —Å–º)');
                }

                // –ü–æ–∫–∞–∑—É—î–º–æ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
                document.querySelector('.calculate-btn').textContent = '‚è≥ –†–æ–∑—Ä–∞—Ö–æ–≤—É—é...';
                document.querySelector('.calculate-btn').disabled = true;

                setTimeout(() => {
                    try {
                        // –†–æ–∑—Ä–∞—Ö—É–Ω–∫–∏
                        const bmr = calculateBMR(weight, height, age, gender);
                        const tdee = bmr * activityLevel;
                        
                        let targetCalories = tdee;
                        if (goal === 'gain') {
                            targetCalories *= 1.15; // +15%
                        } else if (goal === 'lose') {
                            targetCalories *= 0.85; // -15%
                        }

                        const macros = calculateMacronutrients(targetCalories, weight, goal);
                        
                        // –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ–¥—É–∫—Ç—ñ–≤
                        const optimization = optimizeProducts(
                            targetCalories, macros.protein, macros.fat, macros.carbs, 
                            isVegan, isDiabetic
                        );

                        // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
                        displayResults({
                            bmr: Math.round(bmr),
                            tdee: Math.round(tdee),
                            targetCalories: Math.round(targetCalories),
                            macros,
                            optimization,
                            userParams: { gender, age, weight, height, goal, isVegan, isDiabetic }
                        });

                        // –ü–æ–∫–∞–∑—É—î–º–æ —Å–µ–∫—Ü—ñ—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
                        document.getElementById('results').style.display = 'block';
                        document.getElementById('results').scrollIntoView({ behavior: 'smooth' });

                    } catch (error) {
                        showError(error.message);
                    } finally {
                        // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –∫–Ω–æ–ø–∫—É –≤ –Ω–æ—Ä–º–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω
                        document.querySelector('.calculate-btn').textContent = 'üîç –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ —Ä–∞—Ü—ñ–æ–Ω';
                        document.querySelector('.calculate-btn').disabled = false;
                    }
                }, 1000);

            } catch (error) {
                showError(error.message);
                document.querySelector('.calculate-btn').textContent = 'üîç –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ —Ä–∞—Ü—ñ–æ–Ω';
                document.querySelector('.calculate-btn').disabled = false;
            }
        }

        // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
        function displayResults(results) {
            // –ü–æ—Ç—Ä–µ–±–∏ —É –ø–æ–∂–∏–≤–Ω–∏—Ö —Ä–µ—á–æ–≤–∏–Ω–∞—Ö
            const needsHTML = `
                <div class="need-item">
                    <span class="need-value">${results.targetCalories}</span>
                    <div class="need-label">–∫–∫–∞–ª/–¥–µ–Ω—å</div>
                </div>
                <div class="need-item">
                    <span class="need-value">${results.macros.protein}</span>
                    <div class="need-label">–≥ –±—ñ–ª–∫—ñ–≤</div>
                </div>
                <div class="need-item">
                    <span class="need-value">${results.macros.fat}</span>
                    <div class="need-label">–≥ –∂–∏—Ä—ñ–≤</div>
                </div>
                <div class="need-item">
                    <span class="need-value">${results.macros.carbs}</span>
                    <div class="need-label">–≥ –≤—É–≥–ª–µ–≤–æ–¥—ñ–≤</div>
                </div>
            `;
            document.getElementById('nutritional-needs').innerHTML = needsHTML;

            // –°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤
            let productsHTML = '';
            results.optimization.products.forEach(product => {
                const cost = (product.cost * product.amount / 100).toFixed(1);
                productsHTML += `
                    <div class="product-item">
                        <div>
                            <div class="product-name">${product.name}</div>
                            <div class="product-details">${product.amount}–≥ ‚Ä¢ ${cost} –≥—Ä–Ω</div>
                        </div>
                    </div>
                `;
            });
            document.getElementById('products-list').innerHTML = productsHTML;
            
            // –ó–∞–≥–∞–ª—å–Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å
            document.getElementById('total-cost').innerHTML = `
                <div style="text-align: center; font-size: 1.2rem;">
                    üí∞ –ó–∞–≥–∞–ª—å–Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å: ${results.optimization.totalCost.toFixed(2)} –≥—Ä–Ω/–¥–µ–Ω—å
                </div>
                <div style="text-align: center; font-size: 1rem; margin-top: 5px; color: #6c757d;">
                    –§–∞–∫—Ç–∏—á–Ω–æ: ${results.optimization.actualNutrition.calories} –∫–∫–∞–ª, 
                    ${results.optimization.actualNutrition.protein}–≥ –±—ñ–ª–∫—ñ–≤, 
                    ${results.optimization.actualNutrition.fat}–≥ –∂–∏—Ä—ñ–≤, 
                    ${results.optimization.actualNutrition.carbs}–≥ –≤—É–≥–ª–µ–≤–æ–¥—ñ–≤
                </div>
            `;

            // –ü–æ—è—Å–Ω–µ–Ω–Ω—è
            const goalText = {
                'gain': '–Ω–∞–±—ñ—Ä –º\'—è–∑–æ–≤–æ—ó –º–∞—Å–∏',
                'lose': '—Å—Ö—É–¥–Ω–µ–Ω–Ω—è —Ç–∞ —Å—É—à–∫–∞',
                'maintain': '–ø—ñ–¥—Ç—Ä–∏–º–∞–Ω–Ω—è —Ñ–æ—Ä–º–∏'
            };

            const explanationHTML = `
                <p><strong>üéØ –û—Å–Ω–æ–≤–∞ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—ñ–≤:</strong> –í–∞—à—ñ –ø–æ—Ç—Ä–µ–±–∏ —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω—ñ –∑–∞ –Ω–∞—É–∫–æ–≤–æ –æ–±“ë—Ä—É–Ω—Ç–æ–≤–∞–Ω–æ—é —Ñ–æ—Ä–º—É–ª–æ—é –ú—ñ—Ñ—Ñ–ª—ñ–Ω–∞-–°–∞–Ω-–î–∂–µ–æ—Ä:</p>
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li>–ë–∞–∑–∞–ª—å–Ω–∏–π –º–µ—Ç–∞–±–æ–ª—ñ–∑–º (BMR): ${results.bmr} –∫–∫–∞–ª</li>
                    <li>–ó–∞–≥–∞–ª—å–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏ –∑ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—é: ${results.tdee} –∫–∫–∞–ª</li>
                    <li>–¶—ñ–ª—å–æ–≤–∞ –∫–∞–ª–æ—Ä—ñ–π–Ω—ñ—Å—Ç—å –¥–ª—è "${goalText[results.userParams.goal]}": ${results.targetCalories} –∫–∫–∞–ª</li>
                </ul>
                
                <p><strong>‚öñÔ∏è –ü—Ä–∏–Ω—Ü–∏–ø –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:</strong> –°–∏—Å—Ç–µ–º–∞ –ø—ñ–¥—ñ–±—Ä–∞–ª–∞ –Ω–∞–π–¥–µ—à–µ–≤—à–∏–π –Ω–∞–±—ñ—Ä –ø—Ä–æ–¥—É–∫—Ç—ñ–≤, —è–∫–∏–π –∑–∞–±–µ–∑–ø–µ—á—É—î –≤–∞—à—ñ –ø–æ—Ç—Ä–µ–±–∏ –≤ –∫–∞–ª–æ—Ä—ñ—è—Ö —Ç–∞ –æ—Å–Ω–æ–≤–Ω–∏—Ö –º–∞–∫—Ä–æ–Ω—É—Ç—Ä—ñ—î–Ω—Ç–∞—Ö.</p>
                
                <p><strong>ü•ó –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –ø–æ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—é:</strong></p>
                <ul style="margin: 10px 0; padding-left: 20px;">
                    ${results.userParams.goal === 'gain' ? 
                        '<li>–°–ø–æ–∂–∏–≤–∞–π—Ç–µ 20-30–≥ –±—ñ–ª–∫—ñ–≤ –ø—Ä–æ—Ç—è–≥–æ–º 2 –≥–æ–¥–∏–Ω –ø—ñ—Å–ª—è —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –º\'—è–∑–æ–≤–æ–≥–æ —Å–∏–Ω—Ç–µ–∑—É</li><li>–†–æ–∑–ø–æ–¥—ñ–ª—ñ—Ç—å –≤—É–≥–ª–µ–≤–æ–¥–∏ –º—ñ–∂ —Å–Ω—ñ–¥–∞–Ω–∫–æ–º —Ç–∞ –ø—ñ—Å–ª—è-—Ç—Ä–µ–Ω—É–≤–∞–ª—å–Ω–∏–º –ø—Ä–∏–π–æ–º–æ–º —ó–∂—ñ</li>' :
                        results.userParams.goal === 'lose' ?
                        '<li>–ü—ñ–¥—Ç—Ä–∏–º—É–π—Ç–µ –≤–∏—Å–æ–∫–µ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è –±—ñ–ª–∫—ñ–≤ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –º\'—è–∑–æ–≤–æ—ó –º–∞—Å–∏ –ø—Ä–∏ –¥–µ—Ñ—ñ—Ü–∏—Ç—ñ –∫–∞–ª–æ—Ä—ñ–π</li><li>–°–ø–æ–∂–∏–≤–∞–π—Ç–µ –æ—Å–Ω–æ–≤–Ω—É —á–∞—Å—Ç–∏–Ω—É –≤—É–≥–ª–µ–≤–æ–¥—ñ–≤ –Ω–∞–≤–∫–æ–ª–æ —Ç—Ä–µ–Ω—É–≤–∞–Ω—å</li>' :
                        '<li>–î–æ—Ç—Ä–∏–º—É–π—Ç–µ—Å—å –∑–±–∞–ª–∞–Ω—Å–æ–≤–∞–Ω–æ–≥–æ —Ä–æ–∑–ø–æ–¥—ñ–ª—É –ø—Ä–∏–π–æ–º—ñ–≤ —ó–∂—ñ –ø—Ä–æ—Ç—è–≥–æ–º –¥–Ω—è</li><li>–ó–∞–±–µ–∑–ø–µ—á—å—Ç–µ –¥–æ—Å—Ç–∞—Ç–Ω—é –∫—ñ–ª—å–∫—ñ—Å—Ç—å –æ–≤–æ—á—ñ–≤ —Ç–∞ —Ñ—Ä—É–∫—Ç—ñ–≤ –¥–ª—è –º—ñ–∫—Ä–æ–Ω—É—Ç—Ä—ñ—î–Ω—Ç—ñ–≤</li>'
                    }
                    ${results.userParams.isDiabetic ? '<li><strong>ü©∫ –î—ñ–∞–±–µ—Ç–∏—á–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:</strong> –í—Å—ñ –ø—Ä–æ–¥—É–∫—Ç–∏ –º–∞—é—Ç—å –≥–ª—ñ–∫–µ–º—ñ—á–Ω–∏–π —ñ–Ω–¥–µ–∫—Å ‚â§55 –¥–ª—è —Å—Ç–∞–±—ñ–ª—å–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è —Ü—É–∫—Ä—É –≤ –∫—Ä–æ–≤—ñ</li>' : ''}
                    ${results.userParams.isVegan ? '<li><strong>üå± –í–µ–≥–∞–Ω—Å—å–∫—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:</strong> –ü–æ—î–¥–Ω—É–π—Ç–µ —Ä—ñ–∑–Ω—ñ —Ä–æ—Å–ª–∏–Ω–Ω—ñ –±—ñ–ª–∫–∏ –¥–ª—è –ø–æ–≤–Ω–æ–≥–æ –∞–º—ñ–Ω–æ–∫–∏—Å–ª–æ—Ç–Ω–æ–≥–æ –ø—Ä–æ—Ñ—ñ–ª—é</li>' : ''}
                </ul>
            `;
            document.getElementById('explanation').innerHTML = explanationHTML;

            // –°—Ç–≤–æ—Ä—é—î–º–æ –≥—Ä–∞—Ñ—ñ–∫–∏
            createMacroChart(results.macros);
            createWeightChart(results.userParams.weight, results.userParams.goal);
        }

        // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫—Ä—É–≥–æ–≤–æ—ó –¥—ñ–∞–≥—Ä–∞–º–∏ –º–∞–∫—Ä–æ–Ω—É—Ç—Ä—ñ—î–Ω—Ç—ñ–≤
        function createMacroChart(macros) {
            const canvas = document.getElementById('macroChart');
            const ctx = canvas.getContext('2d');
            
            // –û—á–∏—â—É—î–º–æ canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –∫–∞–ª–æ—Ä—ñ–π –≤—ñ–¥ –∫–æ–∂–Ω–æ–≥–æ –º–∞–∫—Ä–æ–Ω—É—Ç—Ä—ñ—î–Ω—Ç–∞
            const proteinCal = macros.protein * 4;
            const fatCal = macros.fat * 9;
            const carbsCal = macros.carbs * 4;
            const total = proteinCal + fatCal + carbsCal;
            
            // –ö–æ–ª—å–æ—Ä–∏
            const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1'];
            const labels = ['–ë—ñ–ª–∫–∏', '–ñ–∏—Ä–∏', '–í—É–≥–ª–µ–≤–æ–¥–∏'];
            const values = [proteinCal, fatCal, carbsCal];
            
            // –¶–µ–Ω—Ç—Ä —Ç–∞ —Ä–∞–¥—ñ—É—Å
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(centerX, centerY) - 10;
            
            let currentAngle = -Math.PI / 2; // –ü–æ—á–∏–Ω–∞—î–º–æ –∑–≤–µ—Ä—Ö—É
            
            // –ú–∞–ª—é—î–º–æ —Å–µ–∫—Ç–æ—Ä–∏
            values.forEach((value, index) => {
                const sliceAngle = (value / total) * 2 * Math.PI;
                
                // –°–µ–∫—Ç–æ—Ä
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                ctx.closePath();
                ctx.fillStyle = colors[index];
                ctx.fill();
                
                // –û–±–≤–æ–¥–∫–∞
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // –ü—ñ–¥–ø–∏—Å–∏
                const labelAngle = currentAngle + sliceAngle / 2;
                const labelX = centerX + Math.cos(labelAngle) * (radius * 0.7);
                const labelY = centerY + Math.sin(labelAngle) * (radius * 0.7);
                
                ctx.fillStyle = 'white';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(labels[index], labelX, labelY - 5);
                ctx.fillText(`${Math.round((value / total) * 100)}%`, labelX, labelY + 10);
                
                currentAngle += sliceAngle;
            });
        }

        // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≥—Ä–∞—Ñ—ñ–∫–∞ –ø—Ä–æ–≥–Ω–æ–∑—É –≤–∞–≥–∏
        function createWeightChart(currentWeight, goal) {
            const canvas = document.getElementById('weightChart');
            const ctx = canvas.getContext('2d');
            
            // –û—á–∏—â—É—î–º–æ canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –≥—Ä–∞—Ñ—ñ–∫–∞
            const padding = 40;
            const chartWidth = canvas.width - 2 * padding;
            const chartHeight = canvas.height - 2 * padding;
            
            // –î–∞–Ω—ñ –¥–ª—è 24 —Ç–∏–∂–Ω—ñ–≤ (6 –º—ñ—Å—è—Ü—ñ–≤)
            const weeks = [];
            const weights = [];
            
            for (let week = 0; week <= 24; week++) {
                weeks.push(week);
                
                if (goal === 'gain') {
                    weights.push(currentWeight + (week * 0.3)); // +0.3 –∫–≥/—Ç–∏–∂–¥–µ–Ω—å
                } else if (goal === 'lose') {
                    weights.push(Math.max(currentWeight - (week * 0.4), currentWeight * 0.85)); // -0.4 –∫–≥/—Ç–∏–∂–¥–µ–Ω—å
                } else {
                    weights.push(currentWeight + (Math.sin(week * 0.2) * 0.5)); // –∫–æ–ª–∏–≤–∞–Ω–Ω—è ¬±0.5 –∫–≥
                }
            }
            
            // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –º—ñ–Ω/–º–∞–∫—Å –¥–ª—è –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è
            const minWeight = Math.min(...weights) - 2;
            const maxWeight = Math.max(...weights) + 2;
            const weightRange = maxWeight - minWeight;
            
            // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
            const getX = (week) => padding + (week / 24) * chartWidth;
            const getY = (weight) => padding + ((maxWeight - weight) / weightRange) * chartHeight;
            
            // –°—ñ—Ç–∫–∞
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;
            
            // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ñ –ª—ñ–Ω—ñ—ó (—Ç–∏–∂–Ω—ñ)
            for (let week = 0; week <= 24; week += 4) {
                const x = getX(week);
                ctx.beginPath();
                ctx.moveTo(x, padding);
                ctx.lineTo(x, padding + chartHeight);
                ctx.stroke();
            }
            
            // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ñ –ª—ñ–Ω—ñ—ó (–≤–∞–≥–∞)
            for (let weight = Math.ceil(minWeight); weight <= Math.floor(maxWeight); weight += 2) {
                const y = getY(weight);
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(padding + chartWidth, y);
                ctx.stroke();
            }
            
            // –õ—ñ–Ω—ñ—è –≥—Ä–∞—Ñ—ñ–∫–∞
            ctx.strokeStyle = goal === 'gain' ? '#28a745' : goal === 'lose' ? '#dc3545' : '#007bff';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            weights.forEach((weight, index) => {
                const x = getX(weeks[index]);
                const y = getY(weight);
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();
            
            // –¢–æ—á–∫–∏
            ctx.fillStyle = ctx.strokeStyle;
            weights.forEach((weight, index) => {
                if (index % 4 === 0) { // –ü–æ–∫–∞–∑—É—î–º–æ —Ç–æ—á–∫–∏ –∫–æ–∂–Ω—ñ 4 —Ç–∏–∂–Ω—ñ
                    const x = getX(weeks[index]);
                    const y = getY(weight);
                    
                    ctx.beginPath();
                    ctx.arc(x, y, 4, 0, 2 * Math.PI);
                    ctx.fill();
                }
            });
            
            // –ü—ñ–¥–ø–∏—Å–∏ –æ—Å–µ–π
            ctx.fillStyle = '#495057';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            
            // –ü—ñ–¥–ø–∏—Å–∏ —Ç–∏–∂–Ω—ñ–≤
            for (let week = 0; week <= 24; week += 8) {
                const x = getX(week);
                ctx.fillText(`${week}—Ç`, x, canvas.height - 10);
            }
            
            // –ü—ñ–¥–ø–∏—Å–∏ –≤–∞–≥–∏
            ctx.textAlign = 'right';
            for (let weight = Math.ceil(minWeight); weight <= Math.floor(maxWeight); weight += 2) {
                const y = getY(weight);
                ctx.fillText(`${weight}–∫–≥`, padding - 10, y + 4);
            }
            
            // –ó–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Å–µ–π
            ctx.textAlign = 'center';
            ctx.font = 'bold 14px Arial';
            ctx.fillText('–¢–∏–∂–Ω—ñ', canvas.width / 2, canvas.height - 5);
            
            ctx.save();
            ctx.translate(15, canvas.height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('–í–∞–≥–∞ (–∫–≥)', 0, 0);
            ctx.restore();
            
            // –ê–Ω–æ—Ç–∞—Ü—ñ—ó
            const startWeight = weights[0];
            const endWeight = weights[weights.length - 1];
            
            ctx.font = '10px Arial';
            ctx.fillStyle = '#6c757d';
            ctx.textAlign = 'left';
            ctx.fillText(`–°—Ç–∞—Ä—Ç: ${startWeight.toFixed(1)}–∫–≥`, padding + 5, padding + 15);
            ctx.textAlign = 'right';
            ctx.fillText(`–ü—Ä–æ–≥–Ω–æ–∑: ${endWeight.toFixed(1)}–∫–≥`, padding + chartWidth - 5, padding + 15);
        }

        // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø–æ–º–∏–ª–∫–∏
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            
            const container = document.querySelector('.main-content');
            container.insertBefore(errorDiv, container.firstChild);
            
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        document.addEventListener('DOMContentLoaded', function() {
            // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
            const inputs = document.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    validateInput(this);
                });
            });
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –≤ localStorage
            const formElements = document.querySelectorAll('input, select');
            formElements.forEach(element => {
                // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è
                const savedValue = localStorage.getItem(`nutrition_${element.id}`);
                if (savedValue !== null) {
                    if (element.type === 'checkbox') {
                        element.checked = savedValue === 'true';
                    } else {
                        element.value = savedValue;
                    }
                }
                
                // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –∑–º—ñ–Ω–∏
                element.addEventListener('change', function() {
                    if (element.type === 'checkbox') {
                        localStorage.setItem(`nutrition_${element.id}`, element.checked);
                    } else {
                        localStorage.setItem(`nutrition_${element.id}`, element.value);
                    }
                });
            });
        });

        // –í–∞–ª—ñ–¥–∞—Ü—ñ—è –≤–≤–µ–¥–µ–Ω–∏—Ö –¥–∞–Ω–∏—Ö
        function validateInput(input) {
            const value = parseFloat(input.value);
            let isValid = true;
            let message = '';
            
            switch(input.id) {
                case 'age':
                    isValid = value >= 16 && value <= 80;
                    message = '–í—ñ–∫ –º–∞—î –±—É—Ç–∏ –≤—ñ–¥ 16 –¥–æ 80 —Ä–æ–∫—ñ–≤';
                    break;
                case 'weight':
                    isValid = value >= 40 && value <= 200;
                    message = '–í–∞–≥–∞ –º–∞—î –±—É—Ç–∏ –≤—ñ–¥ 40 –¥–æ 200 –∫–≥';
                    break;
                case 'height':
                    isValid = value >= 140 && value <= 220;
                    message = '–ó—Ä—ñ—Å—Ç –º–∞—î –±—É—Ç–∏ –≤—ñ–¥ 140 –¥–æ 220 —Å–º';
                    break;
            }
            
            if (!isValid && value) {
                input.style.borderColor = '#dc3545';
                input.style.backgroundColor = '#fff5f5';
                input.title = message;
            } else {
                input.style.borderColor = '#e9ecef';
                input.style.backgroundColor = 'white';
                input.title = '';
            }
        }

        // –§—É–Ω–∫—Ü—ñ—è –µ–∫—Å–ø–æ—Ä—Ç—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
        function exportResults() {
            const results = document.getElementById('results');
            if (results.style.display === 'none') {
                alert('–°–ø–æ—á–∞—Ç–∫—É –≤–∏–∫–æ–Ω–∞–π—Ç–µ —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫!');
                return;
            }
            
            // –ó–±–∏—Ä–∞—î–º–æ –≤—Å—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É —Ñ–æ—Ä–º–∞—Ç—ñ
            const date = new Date().toLocaleDateString('uk-UA');
            const needs = document.getElementById('nutritional-needs').textContent;
            const products = document.getElementById('products-list').textContent;
            const explanation = document.getElementById('explanation').textContent;
            
            const exportText = `
–ï–ö–°–ü–ï–†–¢–ù–ê –°–ò–°–¢–ï–ú–ê –•–ê–†–ß–£–í–ê–ù–ù–Ø –î–õ–Ø –°–ü–û–†–¢–°–ú–ï–ù–Ü–í
============================================
–î–∞—Ç–∞: ${date}

–†–û–ó–†–ê–•–û–í–ê–ù–Ü –ü–û–¢–†–ï–ë–ò:
${needs}

–†–ï–ö–û–ú–ï–ù–î–û–í–ê–ù–Ü –ü–†–û–î–£–ö–¢–ò:
${products}

–ü–û–Ø–°–ù–ï–ù–ù–Ø:
${explanation}

============================================
–¶–µ–π –∑–≤—ñ—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ –µ–∫—Å–ø–µ—Ä—Ç–Ω–æ—é —Å–∏—Å—Ç–µ–º–æ—é.
–†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è –∑ –¥—ñ—î—Ç–æ–ª–æ–≥–æ–º.
            `;
            
            // –°—Ç–≤–æ—Ä—é—î–º–æ —ñ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ñ–∞–π–ª
            const blob = new Blob([exportText], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `nutrition_plan_${date.replace(/\./g, '_')}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // –î–æ–¥–∞—î–º–æ –∫–Ω–æ–ø–∫—É –µ–∫—Å–ø–æ—Ä—Ç—É –ø—ñ—Å–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É
        function addExportButton() {
            const resultsSection = document.getElementById('results');
            if (!document.getElementById('export-btn')) {
                const exportBtn = document.createElement('button');
                exportBtn.id = 'export-btn';
                exportBtn.className = 'calculate-btn';
                exportBtn.textContent = 'üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏';
                exportBtn.onclick = exportResults;
                exportBtn.style.marginTop = '20px';
                
                resultsSection.appendChild(exportBtn);
            }
        }

        // –ú–æ–¥–∏—Ñ—ñ–∫—É—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é displayResults –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–Ω–æ–ø–∫–∏ –µ–∫—Å–ø–æ—Ä—Ç—É
        const originalDisplayResults = displayResults;
        displayResults = function(results) {
            originalDisplayResults(results);
            addExportButton();
        };

        // –§—É–Ω–∫—Ü—ñ—è –æ—á–∏—â–µ–Ω–Ω—è –≤—Å—ñ—Ö –¥–∞–Ω–∏—Ö
        function clearAllData() {
            if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –æ—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ?')) {
                // –û—á–∏—â—É—î–º–æ —Ñ–æ—Ä–º—É
                document.getElementById('gender').value = 'male';
                document.getElementById('age').value = '25';
                document.getElementById('weight').value = '70';
                document.getElementById('height').value = '175';
                document.getElementById('activity').value = '1.55';
                document.getElementById('goal').value = 'maintain';
                document.getElementById('vegan').checked = false;
                document.getElementById('diabetes').checked = false;
                
                // –û—á–∏—â—É—î–º–æ localStorage
                Object.keys(localStorage).forEach(key => {
                    if (key.startsWith('nutrition_')) {
                        localStorage.removeItem(key);
                    }
                });
                
                // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏
                document.getElementById('results').style.display = 'none';
                
                // –ü—Ä–æ–∫—Ä—É—á—É—î–º–æ –¥–æ –ø–æ—á–∞—Ç–∫—É
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // –î–æ–¥–∞—î–º–æ –∫–Ω–æ–ø–∫—É –æ—á–∏—â–µ–Ω–Ω—è
        document.addEventListener('DOMContentLoaded', function() {
            const clearBtn = document.createElement('button');
            clearBtn.textContent = 'üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏ –¥–∞–Ω—ñ';
            clearBtn.className = 'calculate-btn';
            clearBtn.style.background = 'linear-gradient(135deg, #dc3545 0%, #c82333 100%)';
            clearBtn.style.marginLeft = '20px';
            clearBtn.onclick = clearAllData;
            
            const calculateBtn = document.querySelector('.calculate-btn');
            calculateBtn.parentNode.appendChild(clearBtn);
        });
    </script>
</body>
</html>