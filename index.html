<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ï–∫—Å–ø–µ—Ä—Ç–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Ä–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è –¥–ª—è —Å–ø–æ—Ä—Ç—Å–º–µ–Ω—ñ–≤</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: #2c3e50;
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-content {
            display: flex;
            flex-wrap: wrap;
            padding: 20px;
            gap: 20px;
        }

        .input-section {
            flex: 1;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            min-width: 300px;
        }

        .results-section {
            flex: 1;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            min-width: 300px;
        }

        .section-title {
            font-size: 1.3rem;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
        }

        .form-group {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 15px;
        }

        .form-group h3 {
            color: #6c757d;
            margin-bottom: 15px;
            font-size: 1.1rem;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 8px;
        }

        .input-field {
            margin-bottom: 15px;
        }

        .input-field label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
        }

        .input-field input,
        .input-field select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
            transform: scale(1.2);
        }

        .button {
            padding: 15px;
            border-radius: 8px;
            border: none;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            font-size: 1rem;
            margin: 8px 0;
        }

        .button-primary {
            background: #3498db;
        }

        .button-primary:hover {
            background: #2980b9;
        }

        .button-danger {
            background: #e74c3c;
        }

        .button-danger:hover {
            background: #c0392b;
        }

        .button-success {
            background: #27ae60;
        }

        .button-success:hover {
            background: #2ecc71;
        }

        .result-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .result-card h3 {
            color: #6c757d;
            margin-bottom: 15px;
            font-size: 1.1rem;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 8px;
        }

        .needs-display {
            font-family: 'Consolas', monospace;
            white-space: pre-wrap;
            background: #ecf0f1;
            padding: 10px;
            border-radius: 8px;
        }

        .products-list {
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Consolas', monospace;
            white-space: pre-wrap;
            background: #ecf0f1;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .explanation {
            background: #fff9c4;
            padding: 15px;
            border-radius: 8px;
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .charts-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }

        .chart-card {
            flex: 1;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            min-width: 300px;
        }

        .chart-title {
            text-align: center;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèÉ‚Äç‚ôÇÔ∏è –ï–∫—Å–ø–µ—Ä—Ç–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Ä–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è</h1>
            <p>–ü–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è —Å–ø–æ—Ä—Ç—Å–º–µ–Ω—ñ–≤</p>
        </div>

        <div class="main-content">
            <div class="input-section">
                <h2 class="section-title">–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</h2>
                
                <div class="form-group">
                    <h3>–û—Å–æ–±–∏—Å—Ç—ñ –¥–∞–Ω—ñ</h3>
                    
                    <div class="input-field">
                        <label for="gender">–°—Ç–∞—Ç—å:</label>
                        <select id="gender">
                            <option value="–ß–æ–ª–æ–≤—ñ—á–∞">–ß–æ–ª–æ–≤—ñ—á–∞</option>
                            <option value="–ñ—ñ–Ω–æ—á–∞">–ñ—ñ–Ω–æ—á–∞</option>
                        </select>
                    </div>
                    
                    <div class="input-field">
                        <label for="age">–í—ñ–∫ (—Ä–æ–∫—ñ–≤):</label>
                        <input type="number" id="age" min="16" max="80" value="25">
                    </div>
                    
                    <div class="input-field">
                        <label for="weight">–í–∞–≥–∞ (–∫–≥):</label>
                        <input type="number" id="weight" min="40" max="200" step="0.1" value="70">
                    </div>
                    
                    <div class="input-field">
                        <label for="height">–ó—Ä—ñ—Å—Ç (—Å–º):</label>
                        <input type="number" id="height" min="140" max="220" value="175">
                    </div>
                </div>
                
                <div class="form-group">
                    <h3>–°–ø–æ—Ä—Ç–∏–≤–Ω–∞ –¥—ñ—è–ª—å–Ω—ñ—Å—Ç—å</h3>
                    
                    <div class="input-field">
                        <label for="activity">–†—ñ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ:</label>
                        <select id="activity">
                            <option value="–î—É–∂–µ –Ω–∏–∑—å–∫–∞">–î—É–∂–µ –Ω–∏–∑—å–∫–∞</option>
                            <option value="–ù–∏–∑—å–∫–∞">–ù–∏–∑—å–∫–∞</option>
                            <option value="–°–µ—Ä–µ–¥–Ω—è" selected>–°–µ—Ä–µ–¥–Ω—è</option>
                            <option value="–í–∏—Å–æ–∫–∞">–í–∏—Å–æ–∫–∞</option>
                            <option value="–î—É–∂–µ –≤–∏—Å–æ–∫–∞">–î—É–∂–µ –≤–∏—Å–æ–∫–∞</option>
                        </select>
                    </div>
                    
                    <div class="input-field">
                        <label for="goal">–ú–µ—Ç–∞:</label>
                        <select id="goal">
                            <option value="–ü—ñ–¥—Ç—Ä–∏–º–∞–Ω–Ω—è —Ñ–æ—Ä–º–∏" selected>–ü—ñ–¥—Ç—Ä–∏–º–∞–Ω–Ω—è —Ñ–æ—Ä–º–∏</option>
                            <option value="–ù–∞–±—ñ—Ä –º–∞—Å–∏">–ù–∞–±—ñ—Ä –º–∞—Å–∏</option>
                            <option value="–°–∫–∏–¥–∞–Ω–Ω—è –≤–∞–≥–∏/–°—É—à–∫–∞">–°–∫–∏–¥–∞–Ω–Ω—è –≤–∞–≥–∏/–°—É—à–∫–∞</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <h3>–î—ñ—î—Ç–∏—á–Ω—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è</h3>
                    
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="vegan">
                            <label for="vegan">–í–µ–≥–∞–Ω—Å—å–∫–∞ –¥—ñ—î—Ç–∞</label>
                        </div>
                        
                        <div class="checkbox-item">
                            <input type="checkbox" id="diabetes">
                            <label for="diabetes">–î—ñ–∞–±–µ—Ç (–Ω–∏–∑—å–∫–∏–π –ì–Ü)</label>
                        </div>
                    </div>
                </div>
                
                <button id="calculateBtn" class="button button-primary">üîç –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ —Ä–∞—Ü—ñ–æ–Ω</button>
                <button id="clearBtn" class="button button-danger">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏ –¥–∞–Ω—ñ</button>
            </div>
            
            <div class="results-section">
                <h2 class="section-title">–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É</h2>
                
                <div id="resultsContainer" style="display: none;">
                    <div class="result-card">
                        <h3>–†–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω—ñ –ø–æ—Ç—Ä–µ–±–∏</h3>
                        <div id="nutritionalNeeds" class="needs-display"></div>
                    </div>
                    
                    <div class="result-card">
                        <h3>–û–ø—Ç–∏–º–∞–ª—å–Ω–∏–π —Ä–∞—Ü—ñ–æ–Ω</h3>
                        <div id="productsList" class="products-list"></div>
                    </div>
                    
                    <div class="result-card">
                        <h3>–ü–æ—è—Å–Ω–µ–Ω–Ω—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π</h3>
                        <div id="explanation" class="explanation"></div>
                    </div>
                    
                    <div class="charts-container">
                        <div class="chart-card">
                            <div class="chart-title">–†–æ–∑–ø–æ–¥—ñ–ª –º–∞–∫—Ä–æ–Ω—É—Ç—Ä—ñ—î–Ω—Ç—ñ–≤</div>
                            <canvas id="macroChart"></canvas>
                        </div>
                        
                        <div class="chart-card">
                            <div class="chart-title">–ü—Ä–æ–≥–Ω–æ–∑ –∑–º—ñ–Ω–∏ –≤–∞–≥–∏</div>
                            <canvas id="weightChart"></canvas>
                        </div>
                    </div>
                    
                    <button id="saveBtn" class="button button-success">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const ACTIVITY_COEFFICIENTS = {
            '–î—É–∂–µ –Ω–∏–∑—å–∫–∞': 1.2,
            '–ù–∏–∑—å–∫–∞': 1.375,
            '–°–µ—Ä–µ–¥–Ω—è': 1.55,
            '–í–∏—Å–æ–∫–∞': 1.725,
            '–î—É–∂–µ –≤–∏—Å–æ–∫–∞': 1.9
        };

        const GOAL_ADJUSTMENTS = {
            '–ü—ñ–¥—Ç—Ä–∏–º–∞–Ω–Ω—è —Ñ–æ—Ä–º–∏': 0.0,
            '–ù–∞–±—ñ—Ä –º–∞—Å–∏': 0.15,
            '–°–∫–∏–¥–∞–Ω–Ω—è –≤–∞–≥–∏/–°—É—à–∫–∞': -0.15
        };

        const MACRO_RATIOS = {
            '–ü—ñ–¥—Ç—Ä–∏–º–∞–Ω–Ω—è —Ñ–æ—Ä–º–∏': {protein_per_kg: 1.8, fat_percent: 0.25},
            '–ù–∞–±—ñ—Ä –º–∞—Å–∏': {protein_per_kg: 2.2, fat_percent: 0.20},
            '–°–∫–∏–¥–∞–Ω–Ω—è –≤–∞–≥–∏/–°—É—à–∫–∞': {protein_per_kg: 2.5, fat_percent: 0.30}
        };

        // –ë–∞–∑–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø–∏—Ç–∞–Ω–∏—è
        const PRODUCTS_DATABASE = [
            {Name: "–ö—É—Ä—è—á–∞ –≥—Ä—É–¥–∫–∞", Protein: 23.0, Fat: 1.2, Carbs: 0.0, Calories: 113, Cost: 80, Vegan: false, Diabet: 0},
            {Name: "–†–∏—Å –∫—Ä—É–≥–ª–æ–∑–µ—Ä–Ω–∏—Å—Ç–∏–π", Protein: 2.7, Fat: 0.3, Carbs: 77.0, Calories: 344, Cost: 25, Vegan: true, Diabet: 64},
            {Name: "–í—ñ–≤—Å—è–Ω–∫–∞", Protein: 12.0, Fat: 6.2, Carbs: 61.0, Calories: 342, Cost: 30, Vegan: true, Diabet: 42},
            {Name: "–ë–∞–Ω–∞–Ω–∏", Protein: 1.1, Fat: 0.2, Carbs: 21.0, Calories: 89, Cost: 60, Vegan: true, Diabet: 62},
            {Name: "–ú–æ–ª–æ–∫–æ 2.5%", Protein: 2.8, Fat: 2.5, Carbs: 4.7, Calories: 52, Cost: 60, Vegan: false, Diabet: 27},
            {Name: "–Ø–π—Ü—è –∫—É—Ä—è—á—ñ", Protein: 12.7, Fat: 11.5, Carbs: 0.7, Calories: 157, Cost: 60, Vegan: false, Diabet: 0},
            {Name: "–û–ª—ñ—è —Å–æ–Ω—è—à–Ω–∏–∫–æ–≤–∞", Protein: 0.0, Fat: 99.9, Carbs: 0.0, Calories: 899, Cost: 50, Vegan: true, Diabet: 0},
            {Name: "–ì—Ä–µ—á–∫–∞", Protein: 12.6, Fat: 2.6, Carbs: 68.0, Calories: 343, Cost: 45, Vegan: true, Diabet: 54},
            {Name: "–¢–≤–æ—Ä–æ–≥ 5%", Protein: 17.2, Fat: 5.0, Carbs: 1.8, Calories: 121, Cost: 90, Vegan: false, Diabet: 27},
            {Name: "–ö–∞—Ä—Ç–æ–ø–ª—è", Protein: 2.0, Fat: 0.1, Carbs: 16.0, Calories: 77, Cost: 20, Vegan: true, Diabet: 85},
            {Name: "–†–∏–±–∞ –º–æ—Ä—Å—å–∫–∞", Protein: 20.0, Fat: 8.0, Carbs: 0.0, Calories: 150, Cost: 300, Vegan: false, Diabet: 0},
            {Name: "–ö–≤–∞—Å–æ–ª—è —á–µ—Ä–≤–æ–Ω–∞", Protein: 8.4, Fat: 0.3, Carbs: 13.7, Calories: 93, Cost: 60, Vegan: true, Diabet: 29},
            {Name: "–ß–µ—á–µ–≤–∏—Ü—è", Protein: 9.0, Fat: 0.4, Carbs: 20.0, Calories: 116, Cost: 80, Vegan: true, Diabet: 29},
            {Name: "–ì–æ—Ä—ñ—Ö–∏ –≤–æ–ª–æ—Å—å–∫—ñ", Protein: 16.2, Fat: 60.8, Carbs: 11.1, Calories: 656, Cost: 400, Vegan: true, Diabet: 15},
            {Name: "–•–ª—ñ–± –∂–∏—Ç–Ω—ñ–π", Protein: 6.6, Fat: 1.2, Carbs: 34.2, Calories: 174, Cost: 60, Vegan: true, Diabet: 58},
            {Name: "–ö–∞–ø—É—Å—Ç–∞ –±—ñ–ª–æ–∫–∞—á–∞–Ω–Ω–∞", Protein: 1.8, Fat: 0.1, Carbs: 4.7, Calories: 25, Cost: 30, Vegan: true, Diabet: 15},
            {Name: "–û–≥—ñ—Ä–∫–∏ —Å–≤—ñ–∂—ñ", Protein: 0.8, Fat: 0.1, Carbs: 2.5, Calories: 14, Cost: 60, Vegan: true, Diabet: 15},
            {Name: "–ü–æ–º—ñ–¥–æ—Ä–∏", Protein: 1.1, Fat: 0.2, Carbs: 3.7, Calories: 20, Cost: 80, Vegan: true, Diabet: 30}
        ];

        // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        let currentResults = null;
        let macroChart = null;
        let weightChart = null;

        // –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞—Å—á–µ—Ç–æ–≤
        function calculateBMR(weight, height, age, gender) {
            if (gender === '–ß–æ–ª–æ–≤—ñ—á–∞') {
                return 10 * weight + 6.25 * height - 5 * age + 5;
            } else {
                return 10 * weight + 6.25 * height - 5 * age - 161;
            }
        }

        function calculateTDEE(bmr, activityLevel, goal) {
            const activityCoefficient = ACTIVITY_COEFFICIENTS[activityLevel];
            const goalAdjustment = GOAL_ADJUSTMENTS[goal];
            
            const tdee = bmr * activityCoefficient;
            return tdee * (1 + goalAdjustment);
        }

        function calculateMacronutrients(tdee, weight, goal) {
            const ratios = MACRO_RATIOS[goal];
            
            // –ë–µ–ª–∫–∏
            const proteinGrams = weight * ratios.protein_per_kg;
            
            // –ñ–∏—Ä—ã
            const fatCalories = tdee * ratios.fat_percent;
            const fatGrams = fatCalories / 9;  // 9 –∫–∫–∞–ª –Ω–∞ –≥—Ä–∞–º–º –∂–∏—Ä–∞
            
            // –£–≥–ª–µ–≤–æ–¥—ã
            const remainingCalories = tdee - (proteinGrams * 4) - (fatGrams * 9);
            const carbsGrams = remainingCalories / 4;  // 4 –∫–∫–∞–ª –Ω–∞ –≥—Ä–∞–º–º —É–≥–ª–µ–≤–æ–¥–æ–≤
            
            return {
                protein: Math.round(proteinGrams),
                fat: Math.round(fatGrams),
                carbs: Math.round(carbsGrams)
            };
        }

        // –§—É–Ω–∫—Ü–∏–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
        function filterProducts(isVegan = false, isDiabetic = false) {
            return PRODUCTS_DATABASE.filter(product => {
                // –í–µ–≥–∞–Ω—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
                if (isVegan && !product.Vegan) {
                    return false;
                }
                
                // –î–∏–∞–±–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (–ì–ò <= 55)
                if (isDiabetic && product.Diabet > 55 && product.Diabet !== 0) {
                    return false;
                }
                
                return true;
            });
        }

        function optimizeDiet(targetCalories, targetProtein, targetFat, targetCarbs, isVegan = false, isDiabetic = false) {
            // –§–∏–ª—å—Ç—Ä—É–µ–º –ø—Ä–æ–¥—É–∫—Ç—ã
            const products = filterProducts(isVegan, isDiabetic);
            
            if (products.length < 3) {
                throw new Error("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ –¥–ª—è –≤–∏–±—Ä–∞–Ω–∏—Ö –æ–±–º–µ–∂–µ–Ω—å");
            }
            
            // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —É–ø—Ä–æ—â–µ–Ω–Ω–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏, —Ç–∞–∫ –∫–∞–∫ –≤ JS –Ω–µ—Ç –≥–æ—Ç–æ–≤–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
            // –¥–ª—è –ª–∏–Ω–µ–π–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–∞–∫ pulp –≤ Python
            let selectedProducts = [];
            let currentCalories = 0;
            let currentProtein = 0;
            let currentFat = 0;
            let currentCarbs = 0;
            let totalCost = 0;
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø—Ä–æ–¥—É–∫—Ç—ã –ø–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–±–µ–ª–∫–∏/–∫–∫–∞–ª)
            const proteinSources = [...products]
                .filter(p => p.Protein > 15)  // –¢–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –±–µ–ª–∫–∞
                .sort((a, b) => (b.Protein / b.Calories) - (a.Protein / a.Calories));
            
            // –î–æ–±–∞–≤–ª—è–µ–º –±–µ–ª–∫–æ–≤—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã (–æ—Å–Ω–æ–≤–∞ —Ä–∞—Ü–∏–æ–Ω–∞)
            for (let i = 0; i < Math.min(proteinSources.length, 2); i++) {
                const product = proteinSources[i];
                const amount = Math.min(200, (targetProtein * 0.4) / product.Protein * 100);
                
                if (amount > 20) {
                    const calories = (product.Calories * amount) / 100;
                    const protein = (product.Protein * amount) / 100;
                    const fat = (product.Fat * amount) / 100;
                    const carbs = (product.Carbs * amount) / 100;
                    const cost = (product.Cost * amount) / 100;
                    
                    selectedProducts.push({
                        ...product,
                        amount: Math.round(amount),
                        actualCalories: Math.round(calories),
                        actualProtein: Math.round(protein),
                        actualFat: Math.round(fat),
                        actualCarbs: Math.round(carbs),
                        actualCost: Math.round(cost * 100) / 100
                    });
                    
                    currentCalories += calories;
                    currentProtein += protein;
                    currentFat += fat;
                    currentCarbs += carbs;
                    totalCost += cost;
                }
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —É–≥–ª–µ–≤–æ–¥–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã
            const carbSources = products
                .filter(p => p.Carbs > 50 && !selectedProducts.some(s => s.Name === p.Name))
                .sort((a, b) => (b.Carbs / b.Cost) - (a.Carbs / a.Cost));
                
            for (let i = 0; i < Math.min(carbSources.length, 2); i++) {
                const product = carbSources[i];
                const neededCarbs = Math.max(0, targetCarbs - currentCarbs);
                const amount = Math.min(150, (neededCarbs * 0.6) / product.Carbs * 100);
                
                if (amount > 20) {
                    const calories = (product.Calories * amount) / 100;
                    const protein = (product.Protein * amount) / 100;
                    const fat = (product.Fat * amount) / 100;
                    const carbs = (product.Carbs * amount) / 100;
                    const cost = (product.Cost * amount) / 100;
                    
                    selectedProducts.push({
                        ...product,
                        amount: Math.round(amount),
                        actualCalories: Math.round(calories),
                        actualProtein: Math.round(protein),
                        actualFat: Math.round(fat),
                        actualCarbs: Math.round(carbs),
                        actualCost: Math.round(cost * 100) / 100
                    });
                    
                    currentCalories += calories;
                    currentProtein += protein;
                    currentFat += fat;
                    currentCarbs += carbs;
                    totalCost += cost;
                }
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∂–∏—Ä—ã
            if (currentFat < targetFat * 0.8) {
                const fatSources = products
                    .filter(p => p.Fat > 20 && !selectedProducts.some(s => s.Name === p.Name))
                    .sort((a, b) => (b.Fat / b.Cost) - (a.Fat / a.Cost));
                    
                if (fatSources.length > 0) {
                    const product = fatSources[0];
                    const neededFat = targetFat - currentFat;
                    const amount = Math.min(50, (neededFat * 0.8) / product.Fat * 100);
                    
                    if (amount > 5) {
                        const calories = (product.Calories * amount) / 100;
                        const protein = (product.Protein * amount) / 100;
                        const fat = (product.Fat * amount) / 100;
                        const carbs = (product.Carbs * amount) / 100;
                        const cost = (product.Cost * amount) / 100;
                        
                        selectedProducts.push({
                            ...product,
                            amount: Math.round(amount),
                            actualCalories: Math.round(calories),
                            actualProtein: Math.round(protein),
                            actualFat: Math.round(fat),
                            actualCarbs: Math.round(carbs),
                            actualCost: Math.round(cost * 100) / 100
                        });
                        
                        currentCalories += calories;
                        currentProtein += protein;
                        currentFat += fat;
                        currentCarbs += carbs;
                        totalCost += cost;
                    }
                }
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–≤–æ–π –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç–∏
            while (currentCalories < targetCalories * 0.95 && selectedProducts.length < 8) {
                const remainingProducts = products.filter(p => 
                    !selectedProducts.some(s => s.Name === p.Name) && p.Calories > 50
                );
                
                if (remainingProducts.length === 0) break;
                
                const product = remainingProducts[0];
                const neededCalories = targetCalories - currentCalories;
                const amount = Math.min(100, (neededCalories * 0.3) / product.Calories * 100);
                
                if (amount > 10) {
                    const calories = (product.Calories * amount) / 100;
                    const protein = (product.Protein * amount) / 100;
                    const fat = (product.Fat * amount) / 100;
                    const carbs = (product.Carbs * amount) / 100;
                    const cost = (product.Cost * amount) / 100;
                    
                    selectedProducts.push({
                        ...product,
                        amount: Math.round(amount),
                        actualCalories: Math.round(calories),
                        actualProtein: Math.round(protein),
                        actualFat: Math.round(fat),
                        actualCarbs: Math.round(carbs),
                        actualCost: Math.round(cost * 100) / 100
                    });
                    
                    currentCalories += calories;
                    currentProtein += protein;
                    currentFat += fat;
                    currentCarbs += carbs;
                    totalCost += cost;
                } else {
                    break;
                }
            }
            
            return {
                status: 'success',
                products: selectedProducts,
                totalCost: Math.round(totalCost * 100) / 100,
                actualNutrition: {
                    calories: Math.round(currentCalories),
                    protein: Math.round(currentProtein),
                    fat: Math.round(currentFat),
                    carbs: Math.round(currentCarbs)
                }
            };
        }

        // –§—É–Ω–∫—Ü–∏–∏ UI
        function validateAndCollectInput() {
            const age = parseInt(document.getElementById('age').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);
            
            if (isNaN(age) || isNaN(weight) || isNaN(height)) {
                throw new Error("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—ñ —á–∏—Å–ª–æ–≤—ñ –∑–Ω–∞—á–µ–Ω–Ω—è");
            }
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤
            if (age < 16 || age > 80) {
                throw new Error("–í—ñ–∫ –º–∞—î –±—É—Ç–∏ –≤—ñ–¥ 16 –¥–æ 80 —Ä–æ–∫—ñ–≤");
            }
            if (weight < 40 || weight > 200) {
                throw new Error("–í–∞–≥–∞ –º–∞—î –±—É—Ç–∏ –≤—ñ–¥ 40 –¥–æ 200 –∫–≥");
            }
            if (height < 140 || height > 220) {
                throw new Error("–ó—Ä—ñ—Å—Ç –º–∞—î –±—É—Ç–∏ –≤—ñ–¥ 140 –¥–æ 220 —Å–º");
            }
            
            return {
                gender: document.getElementById('gender').value,
                age: age,
                weight: weight,
                height: height,
                activity: document.getElementById('activity').value,
                goal: document.getElementById('goal').value,
                vegan: document.getElementById('vegan').checked,
                diabetes: document.getElementById('diabetes').checked
            };
        }

        function showError(message) {
            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
            const existingErrors = document.querySelectorAll('.error');
            existingErrors.forEach(el => el.remove());
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            
            const inputSection = document.querySelector('.input-section');
            inputSection.prepend(errorDiv);
            
            // –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        function showSuccess(message) {
            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ
            const existingSuccess = document.querySelectorAll('.success');
            existingSuccess.forEach(el => el.remove());
            
            const successDiv = document.createElement('div');
            successDiv.className = 'success';
            successDiv.textContent = message;
            
            const resultsSection = document.querySelector('.results-section');
            resultsSection.prepend(successDiv);
            
            // –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                successDiv.remove();
            }, 5000);
        }

        function displayResults() {
            if (!currentResults) {
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
            document.getElementById('resultsContainer').style.display = 'block';
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏
            const needsText = `üìä –í–ê–®–Ü –ü–û–¢–†–ï–ë–ò:

üî• –ö–∞–ª–æ—Ä—ñ—ó: ${Math.round(currentResults.tdee)} –∫–∫–∞–ª/–¥–µ–Ω—å
ü•© –ë—ñ–ª–∫–∏: ${currentResults.macros.protein} –≥ (${(currentResults.macros.protein*4/currentResults.tdee*100).toFixed(1)}%)
ü•ë –ñ–∏—Ä–∏: ${currentResults.macros.fat} –≥ (${(currentResults.macros.fat*9/currentResults.tdee*100).toFixed(1)}%)
üçû –í—É–≥–ª–µ–≤–æ–¥–∏: ${currentResults.macros.carbs} –≥ (${(currentResults.macros.carbs*4/currentResults.tdee*100).toFixed(1)}%)

üìà BMR: ${Math.round(currentResults.bmr)} –∫–∫–∞–ª
‚ö° TDEE: ${Math.round(currentResults.tdee)} –∫–∫–∞–ª
üéØ –ú–µ—Ç–∞: ${currentResults.userData.goal}`;
            
            document.getElementById('nutritionalNeeds').textContent = needsText;
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø—Ä–æ–¥—É–∫—Ç—ã
            const optResult = currentResults.optimization;
            let productsText = '';
            
            if (optResult.status === 'success') {
                productsText = `üõí –û–ü–¢–ò–ú–ê–õ–¨–ù–ò–ô –†–ê–¶–Ü–û–ù:

üí∞ –ó–∞–≥–∞–ª—å–Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å: ${optResult.totalCost.toFixed(2)} –≥—Ä–Ω/–¥–µ–Ω—å
üìä –§–∞–∫—Ç–∏—á–Ω–∞ –∫–∞–ª–æ—Ä—ñ–π–Ω—ñ—Å—Ç—å: ${optResult.actualNutrition.calories} –∫–∫–∞–ª

üìã –°–ü–ò–°–û–ö –ü–†–û–î–£–ö–¢–Ü–í:
`;
                
                for (const product of optResult.products) {
                    const cost = product.actualCost;
                    productsText += `‚Ä¢ ${product.Name}: ${product.amount}–≥ (‚âà${cost.toFixed(1)} –≥—Ä–Ω)\n`;
                }
                
                productsText += `
üìà –§–ê–ö–¢–ò–ß–ù–ò–ô –°–ö–õ–ê–î:
ü•© –ë—ñ–ª–∫–∏: ${optResult.actualNutrition.protein}–≥
ü•ë –ñ–∏—Ä–∏: ${optResult.actualNutrition.fat}–≥
üçû –í—É–≥–ª–µ–≤–æ–¥–∏: ${optResult.actualNutrition.carbs}–≥`;
            } else {
                productsText = `‚ùå –ü–æ–º–∏–ª–∫–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó: ${optResult.message || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞'}`;
            }
            
            document.getElementById('productsList').textContent = productsText;
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–æ—è—Å–Ω–µ–Ω–∏—è
            displayExplanation();
            
            // –°–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ–∏–∫–∏
            createCharts();
        }

        function displayExplanation() {
            if (!currentResults) {
                return;
            }
            
            const userData = currentResults.userData;
            let explanation = `üîç –ü–û–Ø–°–ù–ï–ù–ù–Ø –†–ï–ö–û–ú–ï–ù–î–ê–¶–Ü–ô:

üéØ –û—Å–Ω–æ–≤–∞ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—ñ–≤: –í–∞—à—ñ –ø–æ—Ç—Ä–µ–±–∏ —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω—ñ –∑–∞ –Ω–∞—É–∫–æ–≤–æ –æ–±“ë—Ä—É–Ω—Ç–æ–≤–∞–Ω–æ—é —Ñ–æ—Ä–º—É–ª–æ—é –ú—ñ—Ñ—Ñ–ª—ñ–Ω–∞-–°–∞–Ω-–î–∂–µ–æ—Ä –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —Ä—ñ–≤–Ω—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ "${userData.activity}" —Ç–∞ –º–µ—Ç–∏ "${userData.goal}".

‚öñÔ∏è –ü—Ä–∏–Ω—Ü–∏–ø –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó: –°–∏—Å—Ç–µ–º–∞ –ø—ñ–¥—ñ–±—Ä–∞–ª–∞ –Ω–∞–π–¥–µ—à–µ–≤—à–∏–π –Ω–∞–±—ñ—Ä –ø—Ä–æ–¥—É–∫—Ç—ñ–≤, —è–∫–∏–π —Ç–æ—á–Ω–æ –∑–∞–±–µ–∑–ø–µ—á—É—î –≤–∞—à—É –∫–∞–ª–æ—Ä—ñ–π–Ω—ñ—Å—Ç—å —Ç–∞ –ø–µ—Ä–µ–≤–∏—â—É—î –º—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ –ø–æ—Ç—Ä–µ–±–∏ –≤ –±—ñ–ª–∫–∞—Ö, –∂–∏—Ä–∞—Ö —Ç–∞ –≤—É–≥–ª–µ–≤–æ–¥–∞—Ö.

ü•ó –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –ø–æ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—é:
`;
            
            if (userData.goal === '–ù–∞–±—ñ—Ä –º–∞—Å–∏') {
                explanation += "‚Ä¢ –°–ø–æ–∂–∏–≤–∞–π—Ç–µ 20-30–≥ –±—ñ–ª–∫—ñ–≤ –ø—Ä–æ—Ç—è–≥–æ–º 2 –≥–æ–¥–∏–Ω –ø—ñ—Å–ª—è —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –º'—è–∑–æ–≤–æ–≥–æ —Å–∏–Ω—Ç–µ–∑—É.\n";
                explanation += "‚Ä¢ –†–æ–∑–ø–æ–¥—ñ–ª—ñ—Ç—å –≤—É–≥–ª–µ–≤–æ–¥–∏ –º—ñ–∂ —Å–Ω—ñ–¥–∞–Ω–∫–æ–º —Ç–∞ –ø—ñ—Å–ª—è-—Ç—Ä–µ–Ω—É–≤–∞–ª—å–Ω–∏–º –ø—Ä–∏–π–æ–º–æ–º —ó–∂—ñ.\n";
            } else if (userData.goal === '–°–∫–∏–¥–∞–Ω–Ω—è –≤–∞–≥–∏/–°—É—à–∫–∞') {
                explanation += "‚Ä¢ –ü—ñ–¥—Ç—Ä–∏–º—É–π—Ç–µ –≤–∏—Å–æ–∫–µ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è –±—ñ–ª–∫—ñ–≤ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –º'—è–∑–æ–≤–æ—ó –º–∞—Å–∏ –ø—Ä–∏ –¥–µ—Ñ—ñ—Ü–∏—Ç—ñ –∫–∞–ª–æ—Ä—ñ–π.\n";
                explanation += "‚Ä¢ –°–ø–æ–∂–∏–≤–∞–π—Ç–µ –æ—Å–Ω–æ–≤–Ω—É —á–∞—Å—Ç–∏–Ω—É –≤—É–≥–ª–µ–≤–æ–¥—ñ–≤ –Ω–∞–≤–∫–æ–ª–æ —Ç—Ä–µ–Ω—É–≤–∞–Ω—å.\n";
            } else {
                explanation += "‚Ä¢ –î–æ—Ç—Ä–∏–º—É–π—Ç–µ—Å—å –∑–±–∞–ª–∞–Ω—Å–æ–≤–∞–Ω–æ–≥–æ —Ä–æ–∑–ø–æ–¥—ñ–ª—É –ø—Ä–∏–π–æ–º—ñ–≤ —ó–∂—ñ –ø—Ä–æ—Ç—è–≥–æ–º –¥–Ω—è.\n";
                explanation += "‚Ä¢ –ó–∞–±–µ–∑–ø–µ—á—å—Ç–µ –¥–æ—Å—Ç–∞—Ç–Ω—é –∫—ñ–ª—å–∫—ñ—Å—Ç—å –æ–≤–æ—á—ñ–≤ —Ç–∞ —Ñ—Ä—É–∫—Ç—ñ–≤ –¥–ª—è –º—ñ–∫—Ä–æ–Ω—É—Ç—Ä—ñ—î–Ω—Ç—ñ–≤.\n";
            }
            
            if (userData.diabetes) {
                explanation += "\nü©∫ –î—ñ–∞–±–µ—Ç–∏—á–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó: –í—Å—ñ –ø—Ä–æ–¥—É–∫—Ç–∏ –º–∞—é—Ç—å –≥–ª—ñ–∫–µ–º—ñ—á–Ω–∏–π —ñ–Ω–¥–µ–∫—Å ‚â§55 –¥–ª—è —Å—Ç–∞–±—ñ–ª—å–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è —Ü—É–∫—Ä—É –≤ –∫—Ä–æ–≤—ñ.";
            }
            
            if (userData.vegan) {
                explanation += "\nüå± –í–µ–≥–∞–Ω—Å—å–∫—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó: –ü–æ—î–¥–Ω—É–π—Ç–µ —Ä—ñ–∑–Ω—ñ —Ä–æ—Å–ª–∏–Ω–Ω—ñ –±—ñ–ª–∫–∏ –¥–ª—è –ø–æ–≤–Ω–æ–≥–æ –∞–º—ñ–Ω–æ–∫–∏—Å–ª–æ—Ç–Ω–æ–≥–æ –ø—Ä–æ—Ñ—ñ–ª—é.";
            }
            
            document.getElementById('explanation').innerHTML = explanation;
        }

        function createCharts() {
            if (!currentResults) {
                return;
            }
            
            // –ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –º–∞–∫—Ä–æ–Ω—É—Ç—Ä–∏–µ–Ω—Ç–æ–≤
            const macroCtx = document.getElementById('macroChart').getContext('2d');
            
            // –ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å –≥—Ä–∞—Ñ–∏–∫, —É–Ω–∏—á—Ç–æ–∂–∞–µ–º –µ–≥–æ
            if (macroChart) {
                macroChart.destroy();
            }
            
            const macros = currentResults.macros;
            const proteinCal = macros.protein * 4;
            const fatCal = macros.fat * 9;
            const carbCal = macros.carbs * 4;
            
            macroChart = new Chart(macroCtx, {
                type: 'pie',
                data: {
                    labels: [`–ë—ñ–ª–∫–∏ (${macros.protein}–≥)`, `–ñ–∏—Ä–∏ (${macros.fat}–≥)`, `–í—É–≥–ª–µ–≤–æ–¥–∏ (${macros.carbs}–≥)`],
                    datasets: [{
                        data: [proteinCal, fatCal, carbCal],
                        backgroundColor: ['#FF6B6B', '#4ECDC4', '#45B7D1'],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((acc, val) => acc + val, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${percentage}% (${value} –∫–∫–∞–ª)`;
                                }
                            }
                        }
                    }
                }
            });
            
            // –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–≥–Ω–æ–∑–∞ –≤–µ—Å–∞
            const weightCtx = document.getElementById('weightChart').getContext('2d');
            
            // –ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å –≥—Ä–∞—Ñ–∏–∫, —É–Ω–∏—á—Ç–æ–∂–∞–µ–º –µ–≥–æ
            if (weightChart) {
                weightChart.destroy();
            }
            
            const currentWeight = currentResults.userData.weight;
            const goal = currentResults.userData.goal;
            const weeks = Array.from({ length: 25 }, (_, i) => i);
            let weightProgression;
            let color;
            
            if (goal === '–ù–∞–±—ñ—Ä –º–∞—Å–∏') {
                weightProgression = weeks.map(week => currentWeight + (0.3 * week));
                color = '#2ECC71';
            } else if (goal === '–°–∫–∏–¥–∞–Ω–Ω—è –≤–∞–≥–∏/–°—É—à–∫–∞') {
                weightProgression = weeks.map(week => Math.max(currentWeight - (0.4 * week), currentWeight * 0.85));
                color = '#E74C3C';
            } else {
                weightProgression = weeks.map(week => currentWeight + (Math.sin(week * 0.2) * 0.5));
                color = '#3498DB';
            }
            
            weightChart = new Chart(weightCtx, {
                type: 'line',
                data: {
                    labels: weeks.map(week => `${week} —Ç–∏–∂`),
                    datasets: [{
                        label: '–ü—Ä–æ–≥–Ω–æ–∑ –≤–∞–≥–∏',
                        data: weightProgression,
                        fill: false,
                        borderColor: color,
                        borderWidth: 2,
                        tension: 0.1,
                        pointRadius: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: '–í–∞–≥–∞ (–∫–≥)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: '–¢–∏–∂–Ω—ñ'
                            }
                        }
                    }
                }
            });
        }

        function calculateNutrition() {
            try {
                // –ò–∑–º–µ–Ω—è–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏
                const calculateBtn = document.getElementById('calculateBtn');
                calculateBtn.textContent = '‚è≥ –†–æ–∑—Ä–∞—Ö–æ–≤—É—é...';
                calculateBtn.disabled = true;
                
                // –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
                const userData = validateAndCollectInput();
                
                // –†–∞—Å—á–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
                const bmr = calculateBMR(
                    userData.weight,
                    userData.height,
                    userData.age,
                    userData.gender
                );
                
                const tdee = calculateTDEE(
                    bmr,
                    userData.activity,
                    userData.goal
                );
                
                const macros = calculateMacronutrients(
                    tdee,
                    userData.weight,
                    userData.goal
                );
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ —Ç—è–∂–µ–ª—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
                setTimeout(() => {
                    try {
                        // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤
                        const optimization = optimizeDiet(
                            tdee,
                            macros.protein,
                            macros.fat,
                            macros.carbs,
                            userData.vegan,
                            userData.diabetes
                        );
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                        currentResults = {
                            userData: userData,
                            bmr: bmr,
                            tdee: tdee,
                            macros: macros,
                            optimization: optimization
                        };
                        
                        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                        displayResults();
                    } catch (error) {
                        showError(error.message);
                    } finally {
                        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                        calculateBtn.textContent = 'üîç –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ —Ä–∞—Ü—ñ–æ–Ω';
                        calculateBtn.disabled = false;
                    }
                }, 500);
                
            } catch (error) {
                showError(error.message);
                const calculateBtn = document.getElementById('calculateBtn');
                calculateBtn.textContent = 'üîç –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ —Ä–∞—Ü—ñ–æ–Ω';
                calculateBtn.disabled = false;
            }
        }

        function clearData() {
            if (confirm("–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –æ—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ?")) {
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ —Ñ–æ—Ä–º—ã
                document.getElementById('gender').value = '–ß–æ–ª–æ–≤—ñ—á–∞';
                document.getElementById('age').value = '25';
                document.getElementById('weight').value = '70';
                document.getElementById('height').value = '175';
                document.getElementById('activity').value = '–°–µ—Ä–µ–¥–Ω—è';
                document.getElementById('goal').value = '–ü—ñ–¥—Ç—Ä–∏–º–∞–Ω–Ω—è —Ñ–æ—Ä–º–∏';
                document.getElementById('vegan').checked = false;
                document.getElementById('diabetes').checked = false;
                
                // –°–∫—Ä—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                document.getElementById('resultsContainer').style.display = 'none';
                
                // –£–¥–∞–ª—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                currentResults = null;
            }
        }

        function saveResults() {
            if (!currentResults) {
                showError("–ù–µ–º–∞—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è");
                return;
            }
            
            try {
                // –°–æ–∑–¥–∞–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç—á–µ—Ç
                const results = currentResults;
                
                let report = `
================================================================================
                    –ó–í–Ü–¢ –ï–ö–°–ü–ï–†–¢–ù–û–á –°–ò–°–¢–ï–ú–ò –•–ê–†–ß–£–í–ê–ù–ù–Ø
================================================================================

–î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è: ${new Date().toLocaleString('uk-UA')}

–ü–ê–†–ê–ú–ï–¢–†–ò –ö–û–†–ò–°–¢–£–í–ê–ß–ê:
${'-'.repeat(50)}
–°—Ç–∞—Ç—å: ${results.userData.gender}
–í—ñ–∫: ${results.userData.age} —Ä–æ–∫—ñ–≤
–í–∞–≥–∞: ${results.userData.weight} –∫–≥
–ó—Ä—ñ—Å—Ç: ${results.userData.height} —Å–º
–†—ñ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ: ${results.userData.activity}
–ú–µ—Ç–∞: ${results.userData.goal}
–í–µ–≥–∞–Ω—Å—å–∫–∞ –¥—ñ—î—Ç–∞: ${results.userData.vegan ? '–¢–∞–∫' : '–ù—ñ'}
–î—ñ–∞–±–µ—Ç: ${results.userData.diabetes ? '–¢–∞–∫' : '–ù—ñ'}

–†–û–ó–†–ê–•–û–í–ê–ù–Ü –ü–û–¢–†–ï–ë–ò:
${'-'.repeat(50)}
–ë–∞–∑–∞–ª—å–Ω–∏–π –º–µ—Ç–∞–±–æ–ª—ñ–∑–º (BMR): ${Math.round(results.bmr)} –∫–∫–∞–ª
–ó–∞–≥–∞–ª—å–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏ (TDEE): ${Math.round(results.tdee)} –∫–∫–∞–ª
–ë—ñ–ª–∫–∏: ${results.macros.protein} –≥
–ñ–∏—Ä–∏: ${results.macros.fat} –≥
–í—É–≥–ª–µ–≤–æ–¥–∏: ${results.macros.carbs} –≥

–û–ü–¢–ò–ú–ê–õ–¨–ù–ò–ô –†–ê–¶–Ü–û–ù:
${'-'.repeat(50)}
`;
                
                const optResult = results.optimization;
                if (optResult.status === 'success') {
                    report += `–ó–∞–≥–∞–ª—å–Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å: ${optResult.totalCost.toFixed(2)} –≥—Ä–Ω/–¥–µ–Ω—å\n`;
                    report += `–§–∞–∫—Ç–∏—á–Ω–∞ –∫–∞–ª–æ—Ä—ñ–π–Ω—ñ—Å—Ç—å: ${optResult.actualNutrition.calories} –∫–∫–∞–ª\n\n`;
                    report += "–°–ü–ò–°–û–ö –ü–†–û–î–£–ö–¢–Ü–í:\n";
                    
                    for (const product of optResult.products) {
                        const cost = product.actualCost;
                        report += `‚Ä¢ ${product.Name}: ${product.amount}–≥ (‚âà${cost.toFixed(1)} –≥—Ä–Ω)\n`;
                    }
                    
                    report += `\n–§–ê–ö–¢–ò–ß–ù–ò–ô –°–ö–õ–ê–î:\n`;
                    report += `–ë—ñ–ª–∫–∏: ${optResult.actualNutrition.protein}–≥\n`;
                    report += `–ñ–∏—Ä–∏: ${optResult.actualNutrition.fat}–≥\n`;
                    report += `–í—É–≥–ª–µ–≤–æ–¥–∏: ${optResult.actualNutrition.carbs}–≥\n`;
                } else {
                    report += `–ü–æ–º–∏–ª–∫–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó: ${optResult.message || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞'}\n`;
                }
                
                report += `
================================================================================
–¶–µ–π –∑–≤—ñ—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ –µ–∫—Å–ø–µ—Ä—Ç–Ω–æ—é —Å–∏—Å—Ç–µ–º–æ—é —Ä–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è –¥–ª—è —Å–ø–æ—Ä—Ç—Å–º–µ–Ω—ñ–≤.
–†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –ø—Ä–æ–∫–æ–Ω—Å—É–ª—å—Ç—É–≤–∞—Ç–∏—Å—è –∑ –∫–≤–∞–ª—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–∏–º –¥—ñ—î—Ç–æ–ª–æ–≥–æ–º –ø–µ—Ä–µ–¥ –≤–Ω–µ—Å–µ–Ω–Ω—è–º
–∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–∏—Ö –∑–º—ñ–Ω –¥–æ —Ä–∞—Ü—ñ–æ–Ω—É —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è.
================================================================================
`;
                
                // –°–æ–∑–¥–∞–µ–º Blob –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
                const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
                const filename = 'nutrition_report_' + new Date().toISOString().split('T')[0] + '.txt';
                
                // –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É –∏ –∏–Ω–∏—Ü–∏–∏—Ä—É–µ–º —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = filename;
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showSuccess(`–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–æ —É —Ñ–∞–π–ª: ${filename}`);
                
            } catch (error) {
                showError(`–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è: ${error.message}`);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            document.getElementById('calculateBtn').addEventListener('click', calculateNutrition);
            document.getElementById('clearBtn').addEventListener('click', clearData);
            document.getElementById('saveBtn').addEventListener('click', saveResults);
        });
    </script>
</body>
</html>